<head> <meta charset="utf-8" </head>
                      <div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h1><a id="PROJ_1"></a>PROJ简介</h1> 
<p>PROJ是一种通用坐标转换软件，用于将地理空间坐标从一个坐标参考系（coordinate reference system, CRS）转换为另一个坐标参考系。</p> 
<p>PROJ官方网站：<a href="https://proj.org/">https://proj.org/</a></p> 
<p>macOS系统可以直接使用homebrew安装：</p> 
<pre><code class="prism language-powershell">brew install proj
</code></pre> 
<h1><a id="PROJ_11"></a>系统和PROJ版本</h1> 
<p>系统：macOS Big Sur<br> PROJ版本：9.0.0</p> 
<h1><a id="c_14"></a>c++实现</h1> 
<p>wgs84_to_utm32651.cpp</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;proj.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 变量定义</span>
    PJ_CONTEXT <span class="token operator">*</span>C<span class="token punctuation">;</span>
    PJ <span class="token operator">*</span>P<span class="token punctuation">;</span>
    PJ <span class="token operator">*</span>norm<span class="token punctuation">;</span>
    PJ_COORD a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>
    ifstream <span class="token function">input</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ofstream <span class="token function">output</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    string line<span class="token punctuation">;</span>
    <span class="token keyword">double</span> timestamp<span class="token punctuation">,</span> latitude<span class="token punctuation">,</span> longtitude<span class="token punctuation">,</span> height<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个上下文对象</span>
    C <span class="token operator">=</span> <span class="token function">proj_context_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
    <span class="token comment">// 创建转换对象</span>
	<span class="token comment">// 第二个参数"EPSG:4326"是源坐标系EPSG代码，第三个参数是目标坐标系EPSG代码</span>
    P <span class="token operator">=</span> <span class="token function">proj_create_crs_to_crs</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token string">"EPSG:4326"</span><span class="token punctuation">,</span> <span class="token string">"EPSG:32651"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> P<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Failed to create transformation object.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    norm <span class="token operator">=</span> <span class="token function">proj_normalize_for_visualization</span><span class="token punctuation">(</span>C<span class="token punctuation">,</span> P<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> norm<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Failed to normalize transformation object.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">proj_destroy</span><span class="token punctuation">(</span>P<span class="token punctuation">)</span><span class="token punctuation">;</span>
    P <span class="token operator">=</span> norm<span class="token punctuation">;</span>

    <span class="token comment">// 从文件中一行一行读取数据，并进行坐标系的转换</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        istringstream <span class="token function">record</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        record <span class="token operator">&gt;&gt;</span> timestamp <span class="token operator">&gt;&gt;</span> latitude <span class="token operator">&gt;&gt;</span> longtitude <span class="token operator">&gt;&gt;</span> height<span class="token punctuation">;</span>

        <span class="token comment">// 初始化PJ_COORD对象</span>
        a <span class="token operator">=</span> <span class="token function">proj_coord</span><span class="token punctuation">(</span>longtitude<span class="token punctuation">,</span> latitude<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将wgs84坐标系下的地理空间坐标 a 转换到utm32651坐标系下</span>
        b <span class="token operator">=</span> <span class="token function">proj_trans</span><span class="token punctuation">(</span>P<span class="token punctuation">,</span> PJ_FWD<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	      
        <span class="token comment">// 输出到文件中</span>
        output<span class="token punctuation">.</span><span class="token function">precision</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        output <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">.</span>enu<span class="token punctuation">.</span>e <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">.</span>enu<span class="token punctuation">.</span>n <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">.</span>enu<span class="token punctuation">.</span>u <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// 销毁所创建的对象</span>
    <span class="token function">proj_destroy</span><span class="token punctuation">(</span>P<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">proj_context_destroy</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>CMakeLists.txt</p> 
<pre><code class="prism language-cpp"><span class="token function">cmake_minimum_required</span><span class="token punctuation">(</span>VERSION <span class="token number">3.5</span> FATAL_ERROR<span class="token punctuation">)</span>

<span class="token function">project</span><span class="token punctuation">(</span> wgs84_to_utm32651 <span class="token punctuation">)</span>

<span class="token function">find_package</span><span class="token punctuation">(</span>PROJ CONFIG REQUIRED<span class="token punctuation">)</span>

<span class="token function">add_executable</span> <span class="token punctuation">(</span> wgs84_to_utm32651 src<span class="token operator">/</span>wgs84_to_utm32651<span class="token punctuation">.</span>cpp<span class="token punctuation">)</span>
<span class="token function">target_link_libraries</span><span class="token punctuation">(</span> wgs84_to_utm32651 PROJ<span class="token double-colon punctuation">::</span>proj <span class="token punctuation">)</span>
</code></pre> 
<p>编译运行即可。</p> 
<h1><a id="QGIS_95"></a>使用QGIS验证</h1> 
<p>转换之后的坐标可以使用QGIS软件进行验证，如果坐标点都能够重叠在一起，说明转换正确。</p> 
<p>QGIS官方网站：<a href="https://www.qgis.org/">https://www.qgis.org/</a></p>
                </div>
                