<head> <meta charset="utf-8" </head>
                      <div id="content_views" class="htmledit_views">
                    <article class="post_article" style="font-size: 16px;"> 
 <h2>7 用户和用户组管理</h2> 
 <h3>7.1 用户配置文件</h3> 
 <h4>7.1.1 用户信息配置文件/etc/passwd</h4> 
 <ol><li>用户管理简介</li></ol> 
 <ul><li>越是对服务器安全性要求高的服务器，越需要建立合理的用户权限等级制度和服务器操作规范。</li><li>在Linux中主要是通过用户配置文件来查看和修改用户信息</li></ul> 
 <ol start="2"><li>/etc/passwd(7个字段)</li></ol> 
 <ul><li>第1字段：用户名称</li><li>第2字段：密码标志</li><li>第3字段：UID(用户ID)
   <ul><li>0：超级用户</li><li>1-499:系统用户(伪用户)</li><li>500-65535:普通用户</li></ul></li><li>第4字段：GID(用户初始组ID)</li><li>第5字段：用户说明(可以省略)</li><li>第6字段：家目录
   <ul><li>普通用户：/home/用户名/</li><li>超级用户：/root/</li></ul></li><li>第7字段：登录之后的Shell</li></ul> 
 <ol start="3"><li>初始组和附加组</li></ol> 
 <ul><li>初始组：就是指用户一登录就立刻拥有这个用户组的相关权限，每个用户的初始组只能有一个，一般就是和这个用户的用户名相同的组名作为这个用户的初始组</li><li>附加组：指用户可以加入多个其他的用户组，并拥有这些组的权限，附加组可以有多个</li></ul> 
 <ol start="4"><li>Shell</li></ol> 
 <ul><li>Shell就是Linux的命令解释器</li><li>在/etc/passwd当中，除了标准Shell是/bin/bash之外，还可以写如/sbin/nologin</li></ul> 
 <h4>7.1.2 影子配置文件/etc/shadow</h4> 
 <ol><li>9个字段</li></ol> 
 <ul><li>第1字段：用户名称</li><li>第2字段：加密密码
   <ul><li>加密算法升级为SHA512散列加密算法</li><li>如果密码位是"!!"或"*"代表没有密码，不能登录</li></ul></li><li>第3字段：密码最后一次修改日期
   <ul><li>使用1970年1月1日作为标准时间，每过一天时间戳加1</li></ul></li><li>第4字段：两次密码的修改时间间隔(和第3字段相比)</li><li>第5字段：密码有效期(和第3字段相比)</li><li>第6字段：密码修改到期前的警告天数(和第5字段相比)</li><li>第7字段：密码到期之后的宽限天数(和第5字段相比)
   <ul><li>0：代表密码过期之后立即失效</li><li>-1:代表密码永远不会失效</li></ul></li><li>第8字段：账号失效时间
   <ul><li>要用时间戳表示</li></ul></li><li>第9字段：保留字段</li></ul> 
 <ol start="2"><li><strong>时间戳换算</strong></li></ol> 
 <ul><li>把时间戳换算成日期
   <ul><li>date -d "1970-01-01 16066 days"</li></ul></li><li>把日期换算成时间戳
   <ul><li>echo \$(($(date --date="2020/02/13" +%s)/86400 + 1))</li></ul></li></ul> 
 <h4>7.1.3 组信息文件/etc/group</h4> 
 <ol><li>四个字段</li></ol> 
 <ul><li>第1字段：组名</li><li>第2字段：组密码标志</li><li>第3字段：GID</li><li>第4字段：组中附加用户</li></ul> 
 <h4>7.1.4 组密码文件/etc/gshadow</h4> 
 <ol><li>四个字段</li></ol> 
 <ul><li>第1字段：组名</li><li>第2字段：组密码</li><li>第3字段：组管理员用户名</li><li>第4字段：组中附加用户</li></ul> 
 <h3>7.2 用户管理相关文件</h3> 
 <ol><li>用户的家目录</li></ol> 
 <ul><li>普通用户：home/用户名/，所有者和所属者都是此用户，权限是700</li><li>超级用户：/root/，所有者和所属者都是root用户，权限是550</li></ul> 
 <ol start="2"><li>用户的邮箱 /var/spool/mail/用户名/</li><li>用户模版目录 /etc/skel</li></ol> 
 <h3>7.3 用户管理命令</h3> 
 <ol><li><strong>添加用户命令useradd</strong></li></ol> 
 <ul><li>useradd [选项] 用户名</li><li>选项：
   <ul><li>-u UID：手动指定用户的UID号</li><li>-d 家目录：手动指定用户的家目录</li><li>-c 用户说明：手动指定用户的说明</li><li>-g 组名：手动指定用户组的初始组</li><li>-G 组名：指定用户的附加组</li><li>-s shell：手动指定用户的登录shell。默认是/bin/bash</li></ul></li><li>添加默认用户(<strong>useradd sc</strong>)之后会变化的地方：
   <ul><li>grep sc /etc/passwd</li><li>grep sc /etc/shadow</li><li>grep sc /etc/group</li><li>grep sc /etc/gshadow</li><li>ll -d /home/sc/ (ll是ls -l的别名)</li><li>ll /var/spool/mail/sc</li></ul></li><li>用户默认值文件：
   <ul><li>/etc/default/useradd</li><li>GROUP=100 #用户默认组</li><li>HOME=/home #用户家目录</li><li>INACTIVE=-1 #密码过期宽限天数(shadow文件7字段)</li><li>EXPIRE= #密码失效时间(8)</li><li>SHELL=/bin/bash #默认shell</li><li>SKEL=/etc/skel #模版目录</li><li>CREATE_MAIL_SPOOL=yes #是否建立邮箱</li><li>/etc/login.defs</li><li>PASS_MAX_DAYS 9999 #密码有效期(5)</li><li>PASS_MIN_DAYS 0 #密码修改间隔(4)</li><li>PASS _MIN_LEN 5 #密码最小5位(PAM)</li><li>PASS_WARN_AGE 7 #密码到期警告(6)</li><li>UID_MIN 500 #最小和最大UID范围</li><li>GID_MAX 60000</li><li>ENCRYPT_METHOD SHA512 #加密模式</li></ul></li></ul> 
 <ol start="2"><li><strong>修改用户密码命令passwd</strong></li></ol> 
 <ul><li>passwd [选项] 用户名</li><li>选项：
   <ul><li>-S 查询用户密码的密码状态。仅root用户可用。</li><li>-l 暂时锁定用户。仅root用户可用。</li><li>-u 解锁用户。仅root用户可用。</li><li>--stdin 可可以通过管道符输出的数据作为用户的密码</li><li>示例：echo“123”｜passwd --stdin lamp</li></ul></li></ul> 
 <ol start="3"><li><strong>修改用户信息命令usermod</strong></li></ol> 
 <ul><li>usermod [选项] 用户名</li><li>选项：
   <ul><li>-u UID：修改用户的UID号</li><li>-c 用户说明：修改用户的用户说明</li><li>-G 组名：修改用户的附加组</li><li>-L：临时锁定用户(Lock)</li><li>-U：解锁用户(Unlock)</li></ul></li></ul> 
 <ol start="4"><li><strong>修改用户密码状态命令chage</strong></li></ol> 
 <ul><li>chage [选项] 用户名</li><li>选项：
   <ul><li>-l：列出用户的详细密码状态</li><li>-d 日期：修改密码最后一次更改日期(shadow3字段)</li><li>-m 天数：两次密码修改间隔(4)</li><li>-M 天数：密码有效期(5)</li><li>-W 天数：密码过期前警告天数(6)</li><li>-I 天数：密码过期后宽限天数(7)</li><li>-E 日期：账号失效时间(8)</li></ul></li><li><strong>chage -d 0 用户名</strong> #把密码修改日期归零，这样用户一登录就要修改密码</li></ul> 
 <ol start="5"><li><strong>删除用户命令userdel</strong></li></ol> 
 <ul><li>userdel [-r] 用户名</li><li>选项：
   <ul><li>-r 删除用户的同时删除用户家目录</li></ul></li><li>手动删除用户：
   <ul><li>vi /etc/passwd</li><li>vi /etc/shadow</li><li>vi /etc/group</li><li>vi /etc/gshadow</li><li>rm -rf /var/spool/mail/sc</li><li>rm -rf /home/sc/</li></ul></li></ul> 
 <ol start="6"><li><strong>查看用户ID命令id</strong></li></ol> 
 <ul><li>id 用户名</li></ul> 
 <ol start="7"><li><strong>切换用户身份命令su -</strong></li></ol> 
 <ul><li>su [-选项] 用户名</li><li>选项：
   <ul><li>-：选项只使用“-”代表连带用户的<strong>环境变量</strong>一起切换</li><li>-c：仅执行一次命令，而不切换用户身份；如：</li><li>su -root -c “useradd user3” #不切换成root，但是执行useradd命令添加user3用户</li></ul></li><li>超级用户切换成普通用户不需要密码，而普通用户切换成其他用户需要密码</li></ul> 
 <h3>7.4 用户组管理命令</h3> 
 <ol><li><strong>添加用户组命令groupadd</strong></li></ol> 
 <ul><li>groupadd [选项] 组名</li><li>选项：
   <ul><li>-g GID：指定组ID</li></ul></li></ul> 
 <ol start="2"><li><strong>修改用户组命令groupmod</strong></li></ol> 
 <ul><li>选项：
   <ul><li>-g GID：修改组ID</li><li>-n 新组名：修改组名</li></ul></li></ul> 
 <ol start="3"><li><strong>删除用户组命令groupdel</strong></li></ol> 
 <ul><li>groupdel 组名</li></ul> 
 <ol start="4"><li><strong>把用户添加入组或从组中删除</strong></li></ol> 
 <ul><li>gpasswd [选项] 组名</li><li>选项：
   <ul><li>-a 用户名：把用户加入组</li><li>-d 用户名：把用户从组中删除</li></ul></li><li>也可以直接修改配置文件</li></ul> 
</article>
                </div>
        